<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>FlowNote</title>
    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            background: #f5f5f7;
        }
        header {
            display: flex;
            align-items: center;
            padding: 16px 24px;
            background: #111827;
            color: white;
        }
        header .logo {
            font-weight: 700;
            font-size: 20px;
        }
        main {
            max-width: 800px;
            margin: 24px auto;
            padding: 0 16px;
        }
        .today-info {
            margin-bottom: 16px;
        }
        .today-date {
            font-size: 18px;
            font-weight: 600;
        }
        .today-summary {
            margin-top: 4px;
            color: #4b5563;
        }
        .section-title {
            margin-top: 24px;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .entry-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .entry-card {
            background: white;
            border-radius: 8px;
            padding: 12px 14px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }
        .entry-content {
            margin: 4px 0;
            white-space: pre-wrap;
        }
        .entry-amount {
            font-weight: 600;
            color: #16a34a;
            font-size: 14px;
        }
        .entry-meta {
            font-size: 12px;
            color: #6b7280;
        }
        .entry-photo img {
            margin-top: 8px;
            max-width: 100%;
            border-radius: 6px;
        }
    </style>
</head>
<body>
<header>
    <div class="logo">FlowNote</div>
</header>
<main>
    <section class="today-info">
        <!-- 오늘 날짜: 2025-11-25 -> 2025년 11월 25일 -->
        <div class="today-date"
             th:text="${#temporals.format(summary.date, 'yyyy년 M월 d일')}">
            오늘 날짜
        </div>

        <div class="today-summary"
             th:text="|오늘 기록 ${summary.entryCount}개 · 총 사용 금액 ${summary.totalAmount}원|">
            오늘 기록 0개 · 총 사용 금액 0원
        </div>
    </section>

    <section class="new-entry">
        <div class="section-title">새 기록 추가</div>

        <form id="entryForm">
            <div style="display: flex; flex-direction: column; gap: 8px;">
            <textarea name="content"
                      placeholder="오늘 있었던 일, 메모, 사용 내역을 적어보세요"
                      required
                      rows="3"
                      style="padding: 8px; border-radius: 6px; border: 1px solid #d1d5db;"></textarea>

                <input type="number"
                       name="amount"
                       placeholder="사용 금액 (원)"
                       min="0"
                       step="1"
                       style="padding: 8px; border-radius: 6px; border: 1px solid #d1d5db;">

                <input type="file"
                       name="file"
                       accept="image/*">

                <button type="submit"
                        style="padding: 8px 12px; border-radius: 6px; border: none;
                           background: #111827; color: white; font-weight: 600;">
                    저장하기
                </button>
            </div>
        </form>
    </section>

    <section>
        <div class="section-title">오늘 기록</div>

        <!-- 기록이 하나도 없을 때 -->
        <div th:if="${#lists.isEmpty(summary.entries)}" class="entry-meta">
            아직 오늘 기록이 없습니다.
        </div>

        <!-- 기록 리스트 -->
        <div class="entry-list" th:if="${!#lists.isEmpty(summary.entries)}">
            <div class="entry-card" th:each="entry : ${summary.entries}">
                <div class="entry-header">
                    <div class="entry-content"
                         th:text="${entry.content}">내용</div>

                    <div class="entry-amount"
                         th:if="${entry.amount != null and entry.amount != 0}"
                         th:text="|+ ${entry.amount}원|">
                        + 0원
                    </div>
                </div>

                <div class="entry-meta"
                     th:text="|작성 시각: ${#temporals.format(entry.createdAt, 'HH:mm:ss')}|">
                    작성 시각: --
                </div>

                <div class="entry-photo" th:if="${entry.photoUrl != null}">
                    <img th:src="${entry.photoUrl}" alt="첨부 사진">
                </div>
            </div>
        </div>
    </section>
    <script>
        const form = document.getElementById('entryForm');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const content = form.content.value.trim();
            const amount = form.amount.value;
            const file = form.file.files[0];

            if (!content) {
                alert("내용을 입력해주세요.");
                return;
            }

            const formData = new FormData();
            formData.append("content", content);
            if (amount) {
                formData.append("amount", amount);
            }
            if (file) {
                formData.append("file", file);
            }

            // 파일이 있으면 /api/entry/photo, 없으면 /api/entry로 보냄
            const url = file ? "/api/entry/photo" : "/api/entry";

            try {
                const res = await fetch(url, {
                    method: "POST",
                    body: formData
                });

                if (!res.ok) {
                    throw new Error("응답이 실패했습니다.");
                }

                // 성공 후 폼 초기화 & 화면 새로고침해서 summary 갱신
                form.reset();
                window.location.reload();
            } catch (err) {
                console.error(err);
                alert("저장 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");
            }
        });
    </script>

</main>
</body>
</html>
